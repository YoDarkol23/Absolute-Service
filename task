ВВЕДЕНИЕ
Современный рынок автомобилей из стран Азии, таких как Япония, Китай и Корея, характеризуется высоким спросом и динамичным предложением. Компания «Абсолют Сервис», занимающаяся импортом и доставкой автомобилей, сталкивается с необходимостью оперативного предоставления клиентам информации о наличии транспортных средств и точного расчета стоимости их доставки до конечного пункта.
Существующие ручные методы обработки запросов и расчетов, основанные на использовании электронных таблиц и прямом контакте с менеджером, являются трудоемкими, замедляют процесс взаимодействия с клиентом и повышают вероятность возникновения ошибок. В условиях высокой конкуренции скорость и точность предоставления услуг являются критически важными факторами.
Для решения этих задач необходима автоматизированная система, которая обеспечит удаленный доступ к актуальной базе данных автомобилей и позволит в полуавтоматическом режиме производить комплексный расчет стоимости доставки. Данный программный проект призван реализовать такую систему, используя клиент-серверную архитектуру для обеспечения надежности, безопасности и масштабируемости.
Цель работы:
Разработка клиент-серверного приложения на языке C++ под операционную систему Linux для автоматизации поиска автомобилей и расчета стоимости их доставки из Японии, Китая и Кореи для компании «Абсолют Сервис».
Для достижения поставленной цели необходимо решить следующие задачи:
1.Реализовать серверную часть приложения, которая:
Обеспечивает постоянное хранение и управление базой данных автомобилей по заданной структуре (марка, модель, год выпуска, объем двигателя, стоимость и т.д.).
Обрабатывает входящие сетевые запросы от клиентов.
Выполняет поиск автомобилей в базе данных по характеристикам или названию по запросу клиента.
Производит расчет итоговой стоимости доставки выбранного автомобиля до указанного города на основе заданных формул, учитывая стоимость авто, логистику, таможенные пошлины и сопутствующие расходы.

2.Реализовать клиентскую часть приложения, которая:
Предоставляет пользователю консольный интерфейс для взаимодействия с сервером.
Формирует и отправляет запросы на поиск автомобиля на сервер.
Отображает полученный от сервера список подходящих автомобилей.
Обеспечивает функционал для выбора конкретного автомобиля и ввода дополнительных данных для расчета (выбор города доставки из фиксированного списка).
Отправляет запрос на расчет стоимости и отображает финальный результат, полученный от сервера.
3.Обеспечить сетевое взаимодействие между клиентом и сервером по протоколу TCP/IP, где сервер будет развернут на выделенном ноутбуке, а клиентская часть — на компьютерах пользователей.
4.Адаптировать программный код для компиляции и стабильной работы в среде Linux.


ФУНКЦИОНАЛЬНЫЕ ТРЕБОВАНИЯ
Главное меню
После запуска программа показывает приветствие и меню:
1.Список автомобилей в наличии
2.Найти автомобиль по характеристикам
3.Найти автомобиль по марке и модели
4.Города, в которые возможна доставка
5.Документы, требующиеся для заказа автомобиля
6.Информация о процессе доставки
7.Вход администратора
1. Список автомобилей в наличии
Вывод всех авто из БД со статусом “в наличии” (cars.json).
Для каждого авто: марка, модель, год, цена, объём двигателя, коробка, руль, пробег.
При отсутствии БД — сообщение об ошибке.
2. Поиск по характеристикам
Пользователь вводит параметры через запятую в предложенном порядке.
Поддержка числовых фильтров (>, <, >=, <= для года, цены, пробега).
Результат — список авто, подходящих под условия, или сообщение «ничего не найдено».
3. Поиск по марке и модели
Ввод марки и/или модели.
Поиск по полям с частичным/ совпадением.
Вывод списка найденных авто.
4. Города доставки
Отображение списка из 10 заранее заданных городов.
Список берётся из файла (cities.json или встроенного списка).
5. Документы для заказа
Вывод содержимого текстового файла с перечнем нужных документов.
6. Процесс доставки
Отображение пошагового описания доставки и платежей из файла(сколько этапов доставки прошло, сколько осталось, примерное время ожидания)
7. Вход администратора
Ввод логина и пароля, проверка по файлу admins.json.
При успешном входе открывается админ-меню:
Просмотр и редактирование данных в БД.
Добавление, изменение, удаление записей.
Все действия логируются.
USE CASES
UC1 – Просмотреть список доступных автомобилей:
Пользователь выбирает пункт 1.
Программа загружает все доступные автомобили из БД.
Список автомобилей выводится пользователю.
UC2 – Найти авто по характеристикам:
Пользователь выбирает пункт 2.
Пользователь вводит через запятую параметры в заданном порядке.
Программа выводит все автомобили, подходящие под заданные характеристики
UC3 – Найти авто по марке и модели:
Пользователь выбирает пункт 3.
Пользователь вводит марку и/или модель автомобиля.
Программа отображает все найденные автомобили, соответствующие запросу
UC4 – Города, в которые возможна доставка:
Пользователь выбирает пункт 4.
Программа загружает список городов из БД.
Список городов выводится пользователю.
UC5 – Документы, требующиеся для заказа:
Пользователь выбирает пункт 5.
Программа открывает текстовый файл с перечнем документов.
Содержимое выводится пользователю.
UC6 – Посмотреть информацию о доставке:
Пользователь выбирает пункт 6.
Пользователь вводит номер доставки (или как решите реализовать)
Программа находит информацию о статусе доставки.
Пользователю выводится пошаговая информация о доставке.
UC7 – Вход администратора:
Пользователь выбирает пункт 7.
Пользователь вводит логин и пароль.
Программа сравнивает введённые данные с данными из базы данных.
При успехе пользователю становится доступна панель администратора.
UC8 – Управление базой данных:
Администратор выбирает нужную базу данных.
Администратор может добавить, удалить или изменить запись.
Программа обновляет данные в базе данных. 


ТЕСТ КЕЙСЫ
Предусловие	Название	Шаги	Ожидаемый результат
Пользователь открыл приложение	Вывод меню	-	Выводится список доступных функций:
«1. Список автомобилей в наличии
2. Найти автомобиль по характеристикам
3. Найти автомобиль по марке и модели
4. Список городов, доступных для доставки автомобиля
5. Список документов, требующихся для оформления заказа
6. Информация о процессе доставки
7. Войти в режим администратора»
Пользователь выбрал пункт «Список автомобилей в наличии»	Вывод списка автомобилей	1. Выбрать номер автомобиля, предложенного в списке
2. Из списка выбрать город доставки автомобиля 	Выводится список автомобилей
1. Появляется надпись: «Выберите номер автомобиля, которого хотите приобрести:»
2. Появляется надпись: «Выберите город доставки автомобиля:»
Появляется надпись: «Вы выбрали *марка и модель автомобиля*, доставка в *город доставки*.
Итоговая стоимость под ключ: *итоговая стоимость*.
Примерный срок доставки: *срок доставки*.»

Пользователь выбрал пункт «Найти автомобиль по характеристикам»	Поиск автомобиля по характеристикам (позитивный)	

Выбрать год выпуска автомобиля и/или объем двигателя автомобиля и/или мощность двигателя и/или страну отправления	Выводится список автомобилей, удовлетворяющих выбранным пользователем характеристикам
	Поиск автомобиля по характеристикам (негативный)		Выводится надпись:
«Извините по Вашему запросу ничего не найдено»


Пользователь выбрал пункт «Найти автомобиль по марке и модели»	Поиск автомобиля по марке и модели (позитивный)	


Выбрать марку и модель автомобиля	Выводится список автомобилей, соответствующих марке и модели, выбранных пользователем
	Поиск автомобиля по марке и модели (негативный)		Выводится надпись:
«Извините по Вашему запросу ничего не найдено»
Пользователь выбрал пункт «Список городов, доступных для доставки автомобиля»	Вывод списка городов, доступных для доставки автомобиля	-	Выводится надпись: «Список городов, доступных для доставки автомобиля:
1. …
2. …
3. …»
Пользователь выбрал пункт «Список документов, требующихся для оформления заказа»	Вывод списка документов, требующихся для оформления заказа	-	Выводится файл, в котором расписаны документы, требующиеся для оформления заказа
Пользователь выбрал пункт «Информация о процессе доставки»	Вывод информации о процессе доставки	-	Выводится файл, в котором подробно расписана вся информация о процессе доставки





Пользователь выбрал пункт «Войти в режим администратора»	Вход в режим администратора (положительный)	





Ввести логин и пароль	Пользователь входит в режим администратора
	Вход в режим администратора (негативный)		Выводится надпись: «Неверный логин и/или пароль»
Пользователь вошел в режим администратора	Режим администратора	1.  Добавить автомобиль
2. Удалить автомобиль	Выводится список автомобилей в наличии
1. Появляется надпись: «Введите марку, модель и характеристики автомобиля»
2. Появляется надпись: «Выберите из списка номер автомобиля, которого хотите удалить»



ОПИСАНИЕ АРХИТЕКТУРЫ ПРОГРАММНОГО ОБЕСПЕЧЕНИЯ
Общее описание системы
Клиент-серверное консольное приложение на C++ для Linux, обеспечивающее оперативный расчет стоимости и сроков доставки автомобилей из азиатских стран. Клиентская часть запускается на компьютере пользователя и предоставляет консольный интерфейс для взаимодействия с сервером. Серверная часть размещается на отдельном устройстве и отвечает за хранение и обработку данных об автомобилях, выполнение поиска по базе данных, расчёт таможенных платежей и стоимости доставки, а также отправку результатов клиенту.
Основные функции
Просмотр каталога автомобилей
Поиск по характеристикам и марке/модели
Информация о городах доставки и документах
Административное управление базой автомобилей
Технический стек:
Язык: C++
Операционная система: Linux
Сетевое взаимодействие: BSD sockets
Сетевой протокол: TCP
Сеть: Boost библиотеки (Asio, Beast)
Формат хранения данных: текстовые файлы (CSV или JSON-подобный формат)
Многопоточность: std::thread – для обработки нескольких клиентов одновремено
Локализация: русский язык
Сборка: CMake
Высокоуровневая архитектура
Принцип работы
Пользователь запускает клиент → Подключается к серверу → 
→ Выбирает действие в меню → Клиент отправляет HTTP запрос → 
→ Сервер обрабатывает запрос → Работает с файлами данных → 
→ Возвращает JSON ответ → Клиент показывает результат
Ключевые характеристики
Клиент-серверная модель - разделение ответственности
Многопользовательская - несколько клиентов одновременно
Консольный интерфейс - простота использования
Файловое хранение - JSON для структурированных данных
Взаимосвязь основных компонентов



Детальная структура серверной части
Сетевой уровень
Назначение: обработка сетевых соединений
HTTP сервер - прием входящих подключений
Пул потоков - обработка multiple клиентов одновременно
Маршрутизатор - распределение запросов по обработчикам
Уровень контроллеров
Назначение: обработка HTTP запросов
Контроллер автомобилей - работа с автомобилями
Контроллер поиска - поиск и фильтрация
Контроллер авторизации - аутентификация администраторов
Контроллер информации - города, документы, доставка
Уровень сервисов (бизнес-логика)
Назначение: реализация бизнес-правил
Сервис автомобилей - управление автомобилями, поиск
Сервис авторизации - проверка учетных данных
Сервис данных - предоставление статической информации
Уровень репозиториев
Назначение: работа с персистентными данными
Репозиторий автомобилей - CRUD операции с cars.json
Репозиторий пользователей - управление учетными записями
Репозиторий документов - работа с текстовыми файлами
Уровень моделей
Назначение: представление бизнес-сущностей
Автомобиль - данные об автомобиле + логика проверки
Пользователь - учетная запись + проверка пароля
Запрос поиска - параметры для поиска автомобилей
Детальная структура клиентской части
Уровень пользовательского интерфейса
Назначение: взаимодействие с пользователем
Главное меню - 7 основных пунктов
Меню администратора - управление данными
Система навигации - переход между экранами
Уровень приложения
Назначение: координация действий
Обработчик меню - реакция на выбор пользователя
Построитель запросов - формирование HTTP запросов
Обработчик ответов - разбор JSON ответов
Сетевой уровень
Назначение: общение с сервером
HTTP клиент - отправка запросов и получение ответов
Менеджер соединений - управление подключением к серверу
Уровень состояния
Назначение: управление состоянием приложения
Менеджер сессии - хранение токена авторизации
Контекст навигации - текущее меню и история
Взаимодействие компонентов
Поток запроса "Поиск автомобилей"
1.Клиент: Пользователь выбирает поиск → вводит параметры
2.Клиент: Формирует POST /search с JSON параметрами
3.Сеть: HTTP запрос к серверу
4.Сервер: Маршрутизатор → Контроллер поиска
5.Сервер: Сервис автомобилей → поиск по критериям
6.Сервер: Репозиторий → чтение и фильтрация cars.json
7.Сервер: Возврат JSON с результатами
8.Клиент: Парсинг ответа → красивый вывод пользователю
Поток запроса "Добавление автомобиля" (админ)
1.Клиент: Админ входит в систему → получает токен
2.Клиент: Выбирает "Добавить автомобиль" → заполняет форму
3.Клиент: POST /admin/cars с токеном и данными автомобиля
4.Сервер: Проверка токена → проверка прав администратора
5.Сервер: Валидация данных автомобиля
6.Сервер: Репозиторий → добавление в cars.json


7.Сервер: Подтверждение успешного добавления
8.Клиент: Уведомление администратора
Многопоточность и параллелизм
Серверная многопоточность
Thread Pool - фиксированное количество рабочих потоков
Асинхронный доступ - неблокирующее принятие соединений
Разделение чтения/записи - множество читателей, один писатель
Основная идея
Сервер создает N рабочих потоков заранее. Каждый новый клиент получает свободный поток. Если все потоки заняты - клиент ждет в очереди.
Визуализация работы

Детальный процесс обработки
Шаг 1: Запуск сервера
Шаг 2: Обработка клиента в потоке:
Поток получает клиента:
1.Читает HTTP запрос от клиента
2.Определяет тип запроса (GET /cars, POST /search, etc.)
3.Вызывает соответствующий обработчик
4.Читает данные из файлов (cars.json и т.д.)
5.Формирует JSON ответ
6.Отправляет ответ клиенту
7.Закрывает соединение
8.Возвращается в пул, готов к новому клиенту
Реальные сценарии работы
(Сценарий: 3 клиента одновременно)
Время 0: Клиент 1 подключается → Получает Поток 1
Время 1: Клиент 2 подключается → Получает Поток 2  
Время 2: Клиент 3 подключается → Получает Поток 3
Время 3: Клиент 1 завершает работу → Поток 1 свободен
Время 4: Клиент 4 подключается → Получает Поток 1
(Сценарий: Больше клиентов, чем потоков)
Есть 4 потока, подключается 6 клиентов:
Клиент 1 → Поток 1
Клиент 2 → Поток 2
Клиент 3 → Поток 3  
Клиент 4 → Поток 4
Клиент 5 → Ждет в очереди
Клиент 6 → Ждет в очереди
Когда Поток 1 освободится → берёт Клиента 5
Когда Поток 2 освободится → берёт Клиента 6
Ключевые преимущества подхода
Для пользователей:
Независимость - работа одного пользователя не блокирует других
Отзывчивость - сервер быстро реагирует на запросы
Надежность - если один запрос упадет, другие продолжают работать
Для системы:
Контроль нагрузки - ограничение числа одновременных обработок
Эффективность - не создаем новый поток для каждого клиента
Стабильность - избегаем "thread explosion"
Технические детали реализации многопоточного доступа
Синхронизация доступа к данным
Проблема: Два потока пытаются одновременно читать cars.json
Решение: Используем shared_mutex (мьютекс для чтения/записи)
•Несколько потоков могут ЧИТАТЬ одновременно
•Только один поток может ПИСАТЬ в один момент
•При записи все чтения блокируются
Выбор размера пула потоков
В случае малого количества потоков, например, 2: 
•Клиенты ждут в очереди
•Экономит ресурсы сервера
В случае слишком большого количества потоков, например, 10:
•Быстрая обработка многих клиентов  
•Больше потребление памяти
•Риск конкуренции за ресурсы
Оптимальным выбором будет от 4 до 8 потоков.
Обработка пиковых нагрузок
Нормальная нагрузка – это 4-8 одновременных клиента (в рамках нашего количества потоков)
Пиковая нагрузка: 10+ клиентов одновременно
Решение:
•Очередь запросов - клиенты ждут своей очереди
•Таймауты - если клиент ждет слишком долго, отменяем
•Приоритеты - админские запросы могут иметь высший приоритет
Что произойдёт в случае падения потока? 
Поток 3 обрабатывает Клиента X → Возникает исключение. Поток 3 завершается с ошибкой. Сервер ловит исключение → логирует ошибку. Пул потоков создает новый Поток 3 взамен упавшего. Остальные потоки продолжают работать нормально. Клиент X получает ошибку соединения.
Что если файл данных заблокирован?
Поток 1 пытается записать в cars.json. Файл заблокирован (другой поток пишет). Поток 1 ждет разблокировки (timeout: 5 секунд). Если время вышло → возвращает ошибку клиенту. Клиент видит "Временная ошибка, попробуйте позже"
Структура данных
Форматы файлов
cars.json:
{
  "cars": [
    {
      "id": 1,
      "brand": "Toyota",
      "model": "Camry",
      "year": 2023,
      "engine_volume": 2.5,
      "steering_wheel": "left",
      "fuel_type": "petrol",
      "price_usd": 25000,
      "country": "Japan",
      "delivery_days": 45,
      "status": "available"
    }
  ],
  "next_id": 2
}

users.json:
{
  "users": [
    {
      "username": "admin",
      "password_hash": "hash_value",
      "role": "administrator"
    }
  ]
}
API интерфейсы
Публичные endpoints
GET    /cars                    # Список всех автомобилей
POST   /search                  # Поиск по характеристикам
GET    /search?brand=X&model=Y  # Поиск по марке и модели
GET    /cities                  # Список городов доставки
GET    /documents               # Требуемые документы
GET    /delivery                # Процесс доставки

Административные endpoints
POST   /admin/login             # Аутентификация администратора
GET    /admin/cars              # Полная база автомобилей
POST   /admin/cars              # Добавление автомобиля
PUT    /admin/cars/{id}         # Редактирование автомобиля
DELETE /admin/cars/{id}         # Удаление автомобиля
Административная система
Функции администратора:
•Просмотр полной базы автомобилей
•Добавление новых автомобилей
•Редактирование существующих записей
•Удаление автомобилей из базы
•Просмотр статистики системы
Механизм безопасности:
•Аутентификация по логину/паролю
•Токены доступа с ограниченным временем жизни
•Проверка прав для каждого административного запрос
•Хеширование паролей в хранилище
Обработка ошибок
Типы ошибок:
•Сетевые ошибки - проблемы с подключением
•Ошибки данных - неверный формат или некорректные данные
•Ошибки доступа - недостаточно прав для операции
•Ошибки файловой системы - проблемы с чтением/записью файлов
Стратегия обработки – выводим информативные сообщения для пользователя и логируем ошибки для диагностики.
